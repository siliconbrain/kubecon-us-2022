(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{6325:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(61174)}])},61174:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return g}});var l=r(47568),t=r(10797),s=r(70655),o=r(85893),i=r(67294),a=r(37676),c=r(46471),u=r(35226),d=r(9551),f=r(26671),x=new TextDecoder,p=new TextEncoder;function v(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.filter(Boolean).join(" ")}function h(e){var n=e.defaultValue,r=e.onChange,l=(0,i.useState)(void 0!==n&&n),t=l[0],s=l[1];return(0,i.useEffect)(function(){null==r||r(t)},[t,r]),(0,o.jsxs)(c.r,{checked:t,onChange:s,className:v(t?"bg-indigo-600":"bg-gray-200","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"),children:[(0,o.jsx)("span",{className:"sr-only",children:"Auto-run"}),(0,o.jsx)("span",{"aria-hidden":"true",className:v(t?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out")})]})}function m(e){var n=e.size;return(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:n,height:n,children:[(0,o.jsx)("polygon",{points:"50,75 35,50 65,50"}),(0,o.jsx)("path",{d:"M50,15 L50,55",fill:"none",stroke:"black",strokeWidth:"10"}),(0,o.jsx)("path",{d:"M30,56 a30,16 0 1,0 40,0",fill:"none",stroke:"black",strokeWidth:"7.5"})]})}function b(e){var n=e.size;return(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:n,height:n,children:[(0,o.jsx)("polygon",{points:"50,90 35,65 65,65"}),(0,o.jsx)("path",{d:"M50,25 L50,75",fill:"none",stroke:"black",strokeWidth:"10"}),(0,o.jsx)("path",{d:"M36,44 a30,16 0 1,1 28,0",fill:"none",stroke:"black",strokeWidth:"7.5"})]})}function g(){u.Z.registerLanguage("json",d.AVB);var e,n,r,c=(0,i.useState)(!1),g=c[0],j=c[1],w=(0,i.useState)(!1),k=w[0],N=w[1],y=(0,i.useState)(""),S=y[0],C=y[1],E=(0,i.useState)([]),_=E[0],Z=E[1],M=(0,i.useState)(null),B=M[0],L=M[1],W=(0,i.useState)(null),I=W[0],P=W[1],z=(0,i.useState)([]),A=z[0],F=z[1],T=(0,i.useState)(10),O=T[0];T[1];var R=(0,i.useState)(null),U=R[0],V=R[1],X=(0,i.useState)(!1),D=X[0],Q=X[1],q=(0,i.useState)(""),G=q[0],H=q[1],J=(0,i.useState)([]),K=J[0],Y=J[1],$=(0,i.useRef)(),ee=(0,a.ZP)(G,{onClose:function(e){var n=e.code,r=e.reason;e.wasClean||console.warn("WebSocket connection was closed abnormally",{code:n,reason:r})},onError:function(e){console.error("WebSocket connection error",e),k&&(C("The connection experienced an error."),N(!1))},onOpen:function(){console.info("WebSocket connection established")}},k),en=ee.lastMessage,er=ee.readyState;(0,i.useEffect)(function(){(0,l.Z)(function(){var e,n;return(0,s.__generator)(this,function(r){switch(r.label){case 0:if(!(null!==en))return[3,2];return n=Uint8Array.bind,[4,en.data.arrayBuffer()];case 1:e=new(n.apply(Uint8Array,[void 0,r.sent()])),F(function(n){return n.concat(e).slice(-O)}),r.label=2;case 2:return[2]}})})()},[en,O,F]),(0,i.useEffect)(function(){C(""),F([])},[G,k]);var el,et=(0,i.useMemo)(function(){var e;return null==I?void 0:null===(e=I.byStage)||void 0===e?void 0:e.find(function(e){return e.stageId===U})},[U,I]),es=function(){return Q(function(e){return!e})},eo=function(){return N(function(e){return!e})},ei=(0,i.useCallback)(function(e){Z(e)},[]),ea=(0,i.useCallback)(function(e){P(e)},[]),ec=(0,i.useCallback)(function(e){Y(function(n){return(0,t.Z)(n).concat([e])})},[]);(0,i.useEffect)(function(){if($.current=new Worker("/worker.js",{type:"module"}),$.current.onmessage=function(e){var n=e.data,r=n.name,l=n.args;return"onPipelineChanged"===r?ei.apply(void 0,(0,t.Z)(l)):"onRecordProcessed"===r?ea.apply(void 0,(0,t.Z)(l)):"onWorkerError"===r?ec.apply(void 0,(0,t.Z)(l)):void console.warn("Worker cannot call function ".concat(r))},(null==_?void 0:_.length)>0){var e;null===(e=$.current)||void 0===e||e.postMessage({name:"loadStagesFromFiles",args:[null==_?void 0:_.map(function(e){return e.origin})]})}return function(){$.current.terminate()}},[]);var eu=(0,i.useCallback)((el=(0,l.Z)(function(e){var n,r;return(0,s.__generator)(this,function(l){n=e.target.files[0],e.target.value=null;try{null===(r=$.current)||void 0===r||r.postMessage({name:"loadStageFromFile",args:[n]})}catch(s){Y(function(e){return(0,t.Z)(e).concat([s])})}return[2]})}),function(e){return el.apply(this,arguments)}),[$]),ed=(0,i.useCallback)(function(e){var n=e.target.value;L(p.encode(n))},[]),ef=(0,i.useCallback)(function(e){var n;null===(n=$.current)||void 0===n||n.postMessage({name:"removeStage",args:[e]})},[$]),ex=(0,i.useCallback)(function(){if(B){var e;null===(e=$.current)||void 0===e||e.postMessage({name:"processRecord",args:[B]})}},[B,$]);return(0,i.useEffect)(function(){g&&ex()},[g,_,B,ex]),(0,i.useEffect)(function(){console.debug("pipeline",_)},[_]),(0,i.useEffect)(function(){console.debug("results",I)},[I]),(0,i.useEffect)(function(){console.debug("record",B)},[B]),(0,o.jsxs)("div",{className:"flex flex-col h-full w-full overflow-hidden",children:[null==K?void 0:K.map(function(e,n){return(0,o.jsxs)("div",{className:"bg-red-100 text-red-700 px-4 py-2 flex justify-between items-center",children:[(0,o.jsx)("div",{children:e.message}),(0,o.jsx)("button",{className:"text-xl text-black",onClick:function(){return Y(function(e){return(0,t.Z)(e.slice(0,n)).concat((0,t.Z)(e.slice(n+1)))})},children:"✕"})]},n)}),(0,o.jsxs)("div",{className:"flex flex-1 h-full w-full",children:[(0,o.jsxs)("div",{className:"mr-4 border-r-2 border-slate-200 border-solid flex flex-col items-center",children:[(0,o.jsxs)("div",{className:"flex-1 pt-4",children:[(0,o.jsx)("h2",{className:"w-full text-center mb-4 text-2xl font-bold",children:"Pipeline"}),(0,o.jsx)("div",{className:"text-xl pl-4 font-medium gap-y-2 flex flex-col",children:null==_?void 0:_.map(function(e){var n,r,l,t=e.id,s=e.origin;return(0,o.jsxs)("div",{className:v("rounded-l-md py-4 pl-4 pr-8 flex justify-between items-center hover:bg-blue-200 cursor-pointer",U===t?"bg-blue-100":""),onClick:function(){return U===t?V(null):V(t)},children:[(0,o.jsx)("div",{className:(null===(r=null==I?void 0:null===(n=I.byStage)||void 0===n?void 0:n.find(function(e){return e.stageId===t}))||void 0===r?void 0:null===(l=r.results)||void 0===l?void 0:l.some(function(e){var n=e.errors;return(null==n?void 0:n.length)>0}))?"text-red-600":"",children:s.name}),(0,o.jsx)("button",{className:"text-lg text-black ml-4 hover:text-red-800",onClick:function(){return ef(t)},children:"✕"})]},t)})})]}),(0,o.jsx)("div",{className:"p-4",children:(0,o.jsxs)("label",{className:"flex items-center justify-center text-blue-800 w-48 h-12 rounded-md cursor-pointer hover:bg-blue-100 ring-2 ring-blue-300 hover:ring-blue-400",children:[(0,o.jsx)("span",{className:"font-bold text-xl",children:"add stage"}),(0,o.jsx)("input",{type:"file",onChange:eu,accept:"application/wasm",className:"hidden"})]})})]}),(0,o.jsxs)("div",{className:"flex-1 pl-2 pr-8 ml-2 flex-col flex pt-8 overflow-hidden",children:[(0,o.jsxs)("div",{className:"flex gap-x-4 relative",children:[(0,o.jsx)("textarea",{className:"block bg-gray-50 pr-32 w-full font-mono resize-none border-0 py-3 focus:ring-1 rounded-md focus:ring-blue-400 ring-slate-200 break-all",placeholder:"Add your log...",rows:8,onChange:ed,value:B?x.decode(B):""}),(0,o.jsxs)("div",{className:"absolute right-0 top-0 pt-4 pr-4 flex items-center gap-x-2 ",children:[(0,o.jsx)("span",{children:"autorun"}),(0,o.jsx)(h,{defaultValue:g,onChange:j})]}),(0,o.jsx)("div",{className:"absolute right-0 bottom-0 pb-4 pr-4",children:(0,o.jsx)("button",{disabled:g,className:"bottom-0 right-0 bg-blue-800 text-white font-bold px-4 py-2 rounded-md disabled:hidden",onClick:ex,children:"run"})})]}),U?null:(0,o.jsx)("div",{className:"text-red-600 text-2xl",children:null==I?void 0:null===(e=I.byStage)||void 0===e?void 0:e.filter(function(e){return e.results.some(function(e){return e.errors.length>0})}).map(function(e){var n,r,l=e.stageId,t=e.results;return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"pl-2 pt-2",children:(0,o.jsx)("span",{className:"font-bold mr-2",children:null===(n=null==_?void 0:_.find(function(e){return l===e.id}))||void 0===n?void 0:null===(r=n.origin)||void 0===r?void 0:r.name})}),null==t?void 0:t.flatMap(function(e){return e.errors}).map(function(e,n){return(0,o.jsx)("div",{className:"pl-4",children:e},n)})]},l)})}),(0,o.jsx)("div",{className:"my-4 px-2 divide-y divide-slate-200 overflow-y-auto",children:et?(0,o.jsx)(o.Fragment,{children:null==et?void 0:null===(n=et.results)||void 0===n?void 0:n.map(function(e,n){var r=e.input,l=e.outputs,t=e.errors;return(0,o.jsxs)("div",{className:"py-2",children:[(0,o.jsxs)("div",{className:"flex text-2xl",children:[(0,o.jsx)("span",{className:"mr-2",children:(0,o.jsx)(m,{size:"26px"})}),(0,o.jsxs)("span",{className:"font-bold text-blue-600 mr-2 whitespace-nowrap",children:[n,"."]}),(0,o.jsx)(u.Z,{language:"json",style:f.IB,customStyle:{display:"inline-block",padding:"0 .5em",wordBreak:"break-all"},wrapLongLines:!0,children:x.decode(r)})]}),null==t?void 0:t.map(function(e,n){return(0,o.jsxs)("div",{className:"pl-4 py-1 text-red-600",children:["Error: ",e]},n)}),(0,o.jsx)("div",{children:null==l?void 0:l.map(function(e,n){return(0,o.jsxs)("div",{className:"py-1 pl-4 flex text-2xl",children:[(0,o.jsx)("span",{className:"mr-2",children:(0,o.jsx)(b,{size:"26px"})}),(0,o.jsxs)("span",{className:"font-bold text-blue-600 mr-2",children:[n,"."]}),(0,o.jsx)(u.Z,{language:"json",style:f.IB,customStyle:{display:"inline-block",padding:"0 .5em",wordBreak:"break-all"},wrapLongLines:!0,children:x.decode(e)})]},n)})})]},n)})}):null==I?void 0:null===(r=I.outputs)||void 0===r?void 0:r.map(function(e,n){return(0,o.jsxs)("div",{className:"py-1 pl-4 flex text-2xl",children:[(0,o.jsx)("span",{className:"mr-2",children:(0,o.jsx)(b,{size:"26px"})}),(0,o.jsxs)("span",{className:"font-bold text-blue-600 mr-2",children:[n,"."]}),(0,o.jsx)(u.Z,{language:"json",style:f.IB,customStyle:{display:"inline-block",padding:"0 .5em",wordBreak:"break-all"},wrapLongLines:!0,children:x.decode(e)})]},n)})})]}),(0,o.jsxs)("div",{className:"flex transition-transform ease-in-out",children:[(0,o.jsx)("div",{className:v(D?"":"mr-[-600px]","self-start mt-2 p-2 border-2 border-r-0 border-slate-200 border-solid rounded-l cursor-pointer transition-all duration-500 ease-in-out hover:bg-blue-100 hover:border-blue-400"),onClick:es,children:(0,o.jsx)("span",{className:"font-bold rotate-180 pb-2",style:{writingMode:"vertical-rl"},children:"Connect"})}),(0,o.jsxs)("div",{className:v(D?"translate-x-0":"translate-x-full","w-[600px] p-4 overflow-hidden border-l-2 border-solid border-slate-200 transition-transform duration-500 ease-in-out flex flex-col"),children:[(0,o.jsx)("h2",{className:"text-xl font-bold self-center py-2",children:"Log source"}),(0,o.jsx)("input",{type:"url",pattern:"wss?://",placeholder:"WebSocket URL",className:"m-2 disabled:bg-slate-100",disabled:er===a.kQ.OPEN,value:G,onInput:function(e){return H(e.target.value)}}),S?(0,o.jsx)("div",{className:"text-red-600 self-end",children:S}):null,(0,o.jsx)("button",{className:"m-2 p-2 w-48 text-blue-800 font-bold rounded-md cursor-pointer ring-2 ring-blue-300 hover:bg-blue-50",disabled:""===G,onClick:eo,children:k?"disconnect":"connect"}),(0,o.jsx)("div",{className:"divide-y divide-slate-200 overflow-scroll",children:null==A?void 0:A.map(function(e,n){return(0,o.jsx)("div",{children:(0,o.jsx)("span",{className:"text-mono p-2 block break-all cursor-pointer hover:bg-blue-50",onClick:function(){return L(e)},children:x.decode(e)})},n)})})]})]})]})]})}}},function(e){e.O(0,[251,774,888,179],function(){return e(e.s=6325)}),_N_E=e.O()}]);